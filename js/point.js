function PointJS(Fb,ba,ca,Ia){var P=this,Ja=!0,Za=!0,$a=!1,W=!1,n=ba,p=ca,z=n/2,A=p/2,g={x:0,y:0},t={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"sans-serif",textBaseline:"top"},U=function(a){console.log("[PointJS] : ",a)},ab=function(a){var b=decodeURI(a.stack.toString().replace(/(@|[\(\)]|[\w]+:\/\/)/g,"")),b=b.split(/\n/),b=(""==b[2]?b[0]:b[1]).split("/"),b=b[b.length-1].split(":");console.log('ERROR "'+a.toString()+'" \n in      '+b[0]+" \n line:   "+b[1]+" \n symbol: "+b[2])};this.game=
{};this.camera={};this.keyControl={};this.mouseControl={};this.touchControl={};this.system={};this.vector={};this.math={};this.colors={};this.brush={};this.audio={};this.wAudio={};this.dialogs={};this.resources={};this.tiles={};this.OOP={};this.system.log=U;this.system.setSettings=function(a){Ja=q(a.isShowError)?a.isShowError:!0;Za=q(a.isStopForError)?a.isStopForError:!0;$a=q(a.isAutoClear)?a.isAutoClear:!1;q(a.isZBuffer)};this.system.setDefaultSettings=function(a){for(var b in a)t[b]=a[b]};var e=
function(a,b){return{x:a,y:b}},I=function(a,b){return{w:a,h:b}},da=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},Ka=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},C=function(a,b,d){if(0!=d){var f=u(d);d=a.x-b.x;a=a.y-b.y;var g=Math.cos(f),f=Math.sin(f);return e(d*g-a*f+b.x,d*f+a*g+b.y)}return e(a.x,a.y)},V=function(a,b){if(3>b.length)return!1;for(var d=0,f=b.length-1,e=b[f].y<a.y,g=0;g<b.length;++g){var h=b[g].y<a.y,f=Ka(b[f],a),k=Ka(b[g],a),f=f.x*(k.y-f.y)-f.y*(k.x-f.x);h&&!e&&0<f&&(d+=1);!h&&e&&0>f&&(d+=
1);f=g;e=h}return 0!=(d&1)};this.vector.point=e;this.vector.v2d=e;this.vector.size=I;this.vector.w2h=I;this.vector.getPointAngle=C;this.vector.isPointIn=V;this.vector.pointMinus=Ka;this.vector.pointPlus=da;this.vector.pointInc=function(a,b){return{x:a.x*b.x,y:a.y*b.y}};this.vector.pointDiv=function(a,b){return{x:a.x/(0!=b.x?b.x:1),y:a.y/(0!=b.y?b.y:1)}};this.vector.pointAbs=function(a){return{x:Math.abs(a.x),y:Math.abs(a.y)}};this.vector.getMidPoint=function(a,b){return q(b)?e((a.x+b.x)/2,(a.y+b.y)/
2):0};this.vector.getDistance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};this.vector.isSame=function(a,b){return q(b)?a.x==b.x&&a.y==b.y:!1};this.vector.getAngle2Points=function(a,b){return 180/Math.PI*Math.atan2(b.y-a.y,b.x-a.x)};var u=function(a){return Math.PI/180*a},Q=function(a,b,d){var f=Math.floor(Math.random()*(b-a+1)+a);return d&&0==f?Q(a,b,d):f};this.math.limit=function(a,b){var d=0<a?1:-1,f=0<b?1:-1;a=Math.abs(a);b=Math.abs(b);return a<b?a*d:b*f};this.math.a2r=
u;this.math.random=Q;this.math.toInt=function(a){return a>>0};var k={loaded:!1,events:{onload:{},preLoop:{},postLoop:{},gameBlur:{},gameFocus:{},gameResize:{}},addEvent:function(a,b,d){"onload"==a&&k.loaded?d():k.events[a][b]=d},delEvent:function(a,b){delete k.events[a][b]},runEvent:function(a){for(var b in k.events[a])if("function"==typeof k.events[a][b])k.events[a][b]()},attach:function(a){var b=function(){window.document.body.appendChild(a)};k.loaded?b():k.addEvent("onload","attachCanvas_PointJS",
b)},getWH:function(){return{w:parseInt(window.document.documentElement.clientWidth)<parseInt(screen.width)?parseInt(window.document.documentElement.clientWidth):parseInt(screen.width),h:parseInt(window.document.documentElement.clientHeight)<parseInt(screen.height)?parseInt(window.document.documentElement.clientHeight):parseInt(screen.height)}}};this.system.delEvent=function(a,b){k.delEvent(a,b)};this.system.addEvent=function(a,b,d){k.addEvent(a,b,d)};this.system.attachDOM=function(a){k.attach(a)};
window.document.body.style.overflow="hidden";var l=window.document.createElement("canvas");l.width=parseInt(ba);l.height=parseInt(ca);l.style.position="fixed";l.style.left=0;l.style.top=0;l.style.zIndex=1E3;l.id="PointJS-canvas_0";if("object"==typeof Ia)for(var La in Ia)La.match(/margin|padding|position/)||(l.style[La]=Ia[La]);k.attach(l);var vb=parseInt(l.style.left),wb=parseInt(l.style.top),h=l.getContext("2d");this.system.setStyle=function(a){if("object"==typeof a)for(var b in a)l.style[b]=a[b]};
this.system.getContext=function(){return h};this.system.resize=function(a,b){n=a||ba;p=b||ca;z=n/2;A=p/2;l.width=n;l.height=p};this.system.initFullPage=function(){k.addEvent("gameResize","PointJS_resizeGame",function(){n=k.getWH().w;p=k.getWH().h;z=n/2;A=p/2;l.width=n;l.height=p});k.runEvent("gameResize","PointJS_resizeGame")};var R=!1,xb=function(){R||(this.requestFullscreen?(this.requestFullscreen(),R=!0):this.mozRequestFullScreen?(this.mozRequestFullScreen(),R=!0):this.webkitRequestFullscreen&&
(this.webkitRequestFullscreen(),R=!0),n=k.getWH().w,p=k.getWH().h,z=n/2,A=p/2,l.width=n,l.height=p)},Na=function(a){R=Ma(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement)};window.document.addEventListener("webkitfullscreenchange",Na);window.document.addEventListener("mozfullscreenchange",Na);window.document.addEventListener("fullscreenchange",Na);this.system.initFullScreen=function(){window.document.documentElement.onclick=xb;k.addEvent("gameResize",
"PointJS_resizeGame",function(){n=k.getWH().w;p=k.getWH().h;z=n/2;A=p/2;l.width=n;l.height=p});k.runEvent("gameResize","PointJS_resizeGame")};this.system.exitFullScreen=function(){window.document.exitFullscreen?(window.document.exitFullscreen(),R=!1):window.document.mozCancelFullScreen?(window.document.mozCancelFullScreen(),R=!1):window.document.webkitExitFullscreen&&(window.document.webkitExitFullscreen(),R=!1);n=k.getWH().w;p=k.getWH().h;z=n/2;A=p/2;l.width=n;l.height=p;n=ba;p=ca;z=n/2;A=p/2;l.width=
n;l.height=p};this.system.isFullScreen=function(){return R};this.system.exitFullPage=function(){n=ba;p=ca;z=n/2;A=p/2;l.width=n;l.height=p};this.system.initFullScale=function(){l.style.width="100%";l.style.height="100%"};this.system.exitFullScale=function(){l.style.width=ba+"px";l.style.height=ca+"px"};this.system.getWH=function(){return k.getWH()};var ua={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,
R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},yb={37:"LEFT",39:"RIGHT",38:"UP",40:"DOWN",32:"SPACE",17:"CTRL",16:"SHIFT",18:"ALT",27:"ESC",13:"ENTER",189:"MINUS",187:"PLUS",20:"CAPS_LOCK",8:"BACKSPACE",9:"TAB",81:"Q",87:"W",69:"E",82:"R",84:"T",89:"Y",85:"U",73:"I",79:"O",80:"P",65:"A",83:"S",
68:"D",70:"F",71:"G",72:"H",74:"J",75:"K",76:"L",90:"Z",88:"X",86:"V",66:"B",78:"N",77:"M",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",67:"C",57:"9",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"},zb={8:!0,9:!0,13:!0,18:!0,16:!0,17:!0,27:!0,112:!0,113:!0,114:!0,115:!0,116:!0,117:!0,118:!0,119:!0,120:!0,121:!0,122:!0,123:!0};this.keyControl.getKeyList=function(){var a,b=[];for(a in ua)b.push(a);return b};var ea={},ma=
{},Y={},na=!1,oa=!1,va=!1,Ab=function(a){Oa(Y,function(a,d,f){1==a&&(f[d]=2)})};this.keyControl.isDown=function(a){return 1==ea[ua[a]]};this.keyControl.isUp=function(a){return 1==ma[ua[a]]};this.keyControl.isPress=function(a){return 1==Y[ua[a]]};this.keyControl.getInputChar=function(){return na};this.keyControl.getInputKey=function(){return yb[oa]};this.keyControl.setInputMode=function(a){va=a};this.keyControl.isInputMode=function(){return va};this.keyControl.exitKeyControl=function(){window.onkeydown=
function(){};window.onkeypress=function(){};window.onkeyup=function(){};k.delEvent("postLoop","PointJS_clearAllKeyUp");ea={};ma={};Y={};va=oa=na=!1};this.keyControl.initKeyControl=function(){window.onkeydown=function(a){if(va)return oa=a.keyCode,zb[a.keyCode]?(a.preventDefault(),!1):!0;a.preventDefault();2!=Y[a.keyCode]&&(Y[a.keyCode]=1);ea[a.keyCode]=!0;return!1};window.onkeypress=function(a){var b=!1;0!=a.which&&0!=a.charCode&&32<=a.which&&(b=String.fromCharCode(a.which));na=b};window.onkeyup=function(a){a.preventDefault();
1==ea[a.keyCode]&&(ma[a.keyCode]=!0);ea[a.keyCode]=!1;delete Y[a.keyCode];return!1};k.addEvent("postLoop","PointJS_clearAllKeyUp",function(){ma={};Ab();oa=na=!1});return this};var y=e(0,0);e(0,0);var pa=!0,Pa="",wa=!1,J=e(0,0),xa=!1,Qa={LEFT:1,RIGHT:3,MIDDLE:2},ya={},za={},qa={},ra=0,bb=function(){ya={};za={};qa={};ra=0;xa=!1},Bb=function(){Oa(qa,function(a,b,d){1==a&&(d[b]=2)})},Aa=function(a){var b=0,d=0;a&&(b=g.x,d=g.y);return e(b+y.x,d+y.y)};this.mouseControl.getPosition=function(){return Aa(1)};
this.mouseControl.getPositionS=function(){return Aa()};this.mouseControl.setCursorImage=function(a){Pa='url("'+a+'"), auto';window.document.body.style.cursor=Pa};this.mouseControl.setVisible=function(a){!pa&&!a||pa&&a||(pa=1==a,window.document.body.style.cursor=pa?Pa:"none")};this.mouseControl.isVisivle=function(){return pa};this.mouseControl.isDown=function(a){return ya[Qa[a]]};this.mouseControl.isUp=function(a){return za[Qa[a]]};this.mouseControl.isPress=function(a){return 1==qa[Qa[a]]};this.mouseControl.isMove=
function(){return xa};this.mouseControl.isInStatic=function(a){var b=Aa(1);return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.mouseControl.isInDynamic=function(a){return V(Aa(1),a)};this.mouseControl.isInObject=function(a){return a.visible?a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox()):!1};this.mouseControl.isWheel=function(a){return"UP"==a&&0<ra||"DOWN"==a&&0>ra};var cb=function(a){a.preventDefault();ra=a.wheelDelta?a.wheelDelta:-a.detail;return!1},Ba=!1,db=
function(){Ba&&(wa=q(window.document.pointerLockElement)||q(window.document.mozPointerLockElement)?!0:!1)};this.mouseControl.initMouseLock=function(){k.addEvent("onload","initPointerLock",function(){Ba=l.requestPointerLock||l.mozRequestPointerLock||!1;window.document.exitPointerLock=window.document.exitPointerLock||window.document.mozExitPointerLock||!1;"onpointerlockchange"in window.document?window.document.addEventListener("pointerlockchange",db,!1):"onmozpointerlockchange"in window.document&&window.document.addEventListener("mozpointerlockchange",
db,!1);if(!Ba)return U("error in initMouseLock: not supported");wa||(l.onclick=Ba)})};this.mouseControl.exitMouseLock=function(){window.document.exitPointerLock();l.onclick=function(){};J=e(0,0)};this.mouseControl.unlockMouse=function(){J=e(0,0);window.document.exitPointerLock()};this.mouseControl.isMouseLock=function(){return wa};this.mouseControl.getSpeed=function(){if(!J.x&&!J.x)return J.x=y.x,J.y=y.y,e();var a=y.x-J.x,b=y.y-J.y;J.x=y.x;J.y=y.y;return e(a,b)};this.mouseControl.isPeekStatic=function(a,
b){return this.isPress(a)?this.isInStatic(b):!1};this.mouseControl.isPeekDynamic=function(a,b){return this.isPress(a)?this.isInDynamic(b):!1};this.mouseControl.isPeekObject=function(a,b){return this.isPress(a)&&b.visible?this.isInDynamic(b.getDynamicBox()):!1};this.mouseControl.initMouseControl=function(){window.onmousemove=function(a){a.preventDefault();a.stopPropagation();if(wa){var b=a.movementY||a.mozMovementY||0;y.x+=a.movementX||a.mozMovementX||0;y.y+=b;return!1}y.x=a.pageX-vb;y.y=a.pageY-wb;
xa=!0;return!1};window.onmousedown=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));ya[a.which]=!0;qa[a.which]=1};window.onmouseup=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));ya[a.which]=!1;za[a.which]=!0;delete qa[a.which]};window.oncontextmenu=window.onselectstart=window.ondragstart=function(){return!1};window.onmousewheel=
cb;window.addEventListener("DOMMouseScroll",cb,!1);k.addEvent("postLoop","PointJS_clearAllMouseUp",function(){za={};Bb();ra=0;xa=!1});return this};this.mouseControl.exitMouseControl=function(){window.onmousemove=window.onmousedown=window.onmouseup=window.oncontextmenu=window.onselectstart=window.ondragstart=window.onmousewheel=function(){};k.delEvent("postLoop","PointJS_clearAllMouseUp");bb()};var Ca=!1,Da=0,Ea=0,K=0,L=0,r=e(0,0),w=[],eb=function(){Ca=!1;Ea=Da=0;r=e(0,0);w=[];L=K=0};this.touchControl.getFixPositionS=
function(){return r.x||r.y?e(r.x,r.y):!1};this.touchControl.getFixPosition=function(){return r.x||r.y?e(r.x+g.x,r.y+g.y):!1};this.touchControl.getRun=function(){var a=0,b=0;r.x&&r.x!=K&&(a=K-r.x);r.y&&r.y!=L&&(b=L-r.y);return e(a,b)};this.touchControl.getVector=function(){var a=0,b=0;r.x&&r.x!=K&&(a=K>r.x?1:-1);r.y&&r.y!=L&&(b=L>r.y?1:-1);return e(a,b)};this.touchControl.isDown=function(){return Ca};this.touchControl.isPress=function(){return 1==Da};this.touchControl.isUp=function(){return 1==Ea};
this.touchControl.getPosition=function(){return e(K+g.x,L+g.y)};this.touchControl.getPositionS=function(){return e(K,L)};this.touchControl.isPeekStatic=function(a){return this.isPress()?this.isInStatic(a):!1};this.touchControl.isPeekDynamic=function(a){return this.isPress()?this.isInDynamic(a):!1};this.touchControl.isPeekObject=function(a){return this.isPress()&&a.visible?this.isInDynamic(a.getDynamicBox()):!1};this.touchControl.isInStatic=function(a){var b=this.getPosition();return b.x>=a.x&&b.x<=
a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.touchControl.isInDynamic=function(a){return V(this.getPosition(),a)};this.touchControl.isTouchesInDynamic=function(a){if(1>w.length)return!1;var b;for(b=0;b<w.length;b++)if(V(e(w[b].pageX+g.x,w[b].pageY+g.y),a))return!0;return flase};this.touchControl.isTouchesInStatic=function(a){if(1>w.length)return!1;var b;for(b=0;b<w.length;b++){var d=e(w[b].pageX+g.x,w[b].pageY+g.y);if(d.x>=a.x&&d.x<=a.x+a.w&&d.y>=a.y&&d.y<=a.y+a.h)return!0}return flase};this.touchControl.getTouches=
function(){if(1>w.length)return!1;var a=[],b;for(b=0;b<w.length;b++)a.push({screenX:w[b].pageX,screenY:w[b].pageY,x:w[b].pageX+g.x,y:w[b].pageY+g.y});return a};this.touchControl.initTouchControl=function(){window.addEventListener("touchstart",function(a){a.preventDefault();K=a.targetTouches[0].pageX;L=a.targetTouches[0].pageY;r.x=K;r.y=L;w=a.targetTouches;Ca=!0;Da=1;return!1},!0);window.addEventListener("touchmove",function(a){a.preventDefault();K=a.targetTouches[0].pageX;L=a.targetTouches[0].pageY;
w=a.targetTouches;return!1},!0);window.addEventListener("touchend",function(a){a.preventDefault();w=a.targetTouches;r.x=0;r.y=0;Ca=!1;Ea=1;return!1},!0);P.touchControl.vibrate=function(a){if(window.navigator.vibrate)return window.navigator.vibrate(a);if(window.navigator.oVibrate)return window.navigator.oVibrate(a);if(window.navigator.mozVibrate)return window.navigator.mozVibrate(a);if(window.navigator.webkitVibrate)return window.navigator.webkitVibrate(a)};k.addEvent("postLoop","PointJS_touchStopPress",
function(){Ea=Da=0});return this};this.touchControl.exitTouchControl=function(){window.ontouchstart=window.ontouchmove=window.ontouchend=function(a){};k.delEvent("postLoop","PointJS_touchStopPress");eb()};var Cb={name:"PointJS",desc:"2D game engine for JavaScript",author:"Skaner -> skaner0@yandex.ru"};this.system.getInfo=function(){return Cb};var Fa=function(a,b,d,f){return"rgba("+a+", "+b+", "+d+", "+(f?f:1)+")"},fb=function(a,b){a="#"==a[0]?a.substr(1,6):a;var d=parseInt(a.substr(0,2),16),f=parseInt(a.substr(2,
2),16),e=parseInt(a.substr(4,2),16);return Fa(d,f,e,b)};this.colors.linearGradient=function(a,b,d){var f=window.document.createElement("canvas");f.width=b;f.height=b;var e=f.getContext("2d");a="horizontal"==a?e.createLinearGradient(0,0,0,b):e.createLinearGradient(0,0,b,0);var g=1/(d.length-1),h,k=0;for(h=0;1>=h;h+=g)a.addColorStop(h,Ma(d[k])?d[k]:"rgba(255, 255, 255, 0)"),k++;e.fillStyle=a;e.fillRect(0,0,b,b);return e.createPattern(f,"repeat")};this.colors.rgb=function(a,b,d){return Fa(a,b,d,1)};
this.colors.rgba=function(a,b,d,f){return Fa(a,b,d,f)};this.colors.hex2rgb=function(a){return fb(a,1)};this.colors.hex2rgba=function(a,b){return fb(a,b)};this.colors.randomColor=function(a,b,d){return Fa(Q(a,b),Q(a,b),Q(a,b),d||1)};var q=function(a){return"undefined"==typeof a||null==a?!1:!0},Ma=function(a){return q(a)&&""!==a&&0!==a?!0:!1},Oa=function(a,b){for(var d in a)b(a[d],d,a)},gb=function(a,b){if(0!=a.length){var d,f;d=0;for(f=a.length;d<f;d++)b(a[d],d,a)}};this.OOP.insertArrElement=function(a,
b){var d=a[b];a.splice(b,1);return d};this.OOP.insertRandArrElement=function(a){var b=Q(0,a.length-1),d=a[b];a.splice(b,1);return d};this.OOP.drawArr=function(a){var b,d;b=0;for(d=a.length;b<d;b++)a[b].isInCamera&&a[b].draw&&a[b].isInCamera()&&a[b].draw()};this.OOP.readJSON=function(a,b){var d={},f=new XMLHttpRequest;f.open("GET",a,!0);v.add();f.onreadystatechange=function(){4==f.readyState&&(d=f.responseText,d=JSON.parse(d),v.load(),b(d))};f.send()};this.OOP.toString=function(a,b){var d,f=0,e,g=
"[";for(d in a)e=a[d],"number"==typeof e&&b&&(e=parseInt(e)),g+=(0<f?", ":"")+d+" : "+e,f++;return g+"]"};this.OOP.isDef=q;this.OOP.isSet=Ma;this.OOP.forEach=Oa;this.OOP.forInt=function(a,b){var d;for(d=0;d<a;d++)b(d)};this.OOP.forXY=function(a,b,d){var f,e;for(e=0;e<b;e++)for(f=0;f<a;f++)d(f,e)};this.OOP.forArr=gb;this.OOP.randArrElement=function(a){return a[Q(0,a.length)]};this.OOP.readJSONSync=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send();a=b.responseText;return a=JSON.parse(a)};
var fa=60,M=0,hb=0,Ga=-1,ga={};this.game.setFPS=function(a){fa=0<a?a:60};this.game.getFPS=function(){return fa};this.game.getDT=function(a){a||(a=1E3);return hb/a};this.game.getTime=function(){return M};var ib=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/fa)}},sa=ib(),S={func:function(){console.log('please, use a "setLoop" function.');
sa=function(){}},start:!1,end:!1,audio:!1,fps:!1},jb=function(){if(S.audio)for(var a in S.audio)S.audio[a].stop()};this.game.newLoop=function(a,b){"function"==typeof b?ga[a]={func:b,start:!1,end:!1,audio:!1,fps:!1}:ha("error im newLoop: "+b+" is not a function")};this.game.setLoopSound=function(a,b){var d;ga[a].audio||(ga[a].audio=[]);for(d=0;d<b.length;d++)b[d].setNextPlay(b[d+1==b.length?0:d+1]),ga[a].audio.push(b[d])};this.game.setLoop=function(a){if(!ga[a])return ha("setLoop: "+a+" is no a Loop");
jb();bb();ea={};ma={};Y={};oa=na=!1;eb();Ra(e(0,0));S=ga[a];S.audio&&S.audio[0].play()};var lb=function(){try{M=Date.now(),$a&&kb(e(0,0),e(n,p)),k.runEvent("preLoop"),S.func(),k.runEvent("postLoop"),-1!=Ga&&(hb=M-Ga),Ga=M}catch(a){Ja&&ab(a),Za&&(Ja||ab(a),ha())}setTimeout(function(){sa(lb)},1E3/fa)},mb=function(a){W||(W=!0,fa=a||60,sa(lb))},ha=function(a){if(!W)return U(q(a)?a:"game is stop");W=!1;jb();sa=function(){U(q(a)?a:"game is stop")}};this.game.getWH=function(){return{w:n,h:p,w2:z,h2:A}};
this.game.startLoop=function(a,b){this.setLoop(a);this.start(b)};this.game.start=mb;this.game.stop=ha;this.game.resume=function(a){W||(S.audio&&S.audio[0].play(),U(a||"game is run"),sa=ib(),Ga=-1,mb(fa))};var Db=[],Eb=0,Z=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b},x=function(a){this.type="BaseObject";this.id=Eb++;this.x=a.x||0;this.y=a.y||0;this.w=a.w||5;this.h=a.h||5;this.fillColor=a.fillColor||!1;this.strokeColor=a.strokeColor||t.strokeStyle;this.strokeWidth=
a.strokeWidth||0;this.angle=a.angle||0;this.alpha=q(a.alpha)?a.alpha:1;this.center=e(0,0);this.box={x:0,y:0,w:0,h:0};this.visible=q(a.visible)?a.visible:!0;this.flip=e(0,0);this.setShadow(a);a.userData&&this.setUserData(a.userData);a.center&&this.setCenter(a.center);a.box&&this.setBox(a.box);a.position&&this.setPositionC(a.position);a.positionC&&this.setPositionC(a.positionC);Db.push(this)};x.prototype={getID:function(){return this.id},getType:function(){return this.type},setBox:function(a){a.offset&&
(this.box.x=a.offset.x||0,this.box.y=a.offset.y||0);a.size&&(this.box.w=a.size.w||0,this.box.h=a.size.h||0)},isArrIntersect:function(a){var b;for(b=0;b<a.length;b++)if(a[b].id!=this.id&&this.isIntersect(a[b]))return a[b];return!1},isArrInside:function(a){var b;for(b=0;b<a.length;b++)if(this.isDynamicInside(a[b].getDynamicBox()))return a[b];return!1},getNearest:function(a){var b,d=0,f=!1;for(b=0;b<a.length;b++)if(this.id!=a[b].id){!1===f&&(f=this.getDistanceC(a[b].getPositionC()),d=b);var e=this.getDistanceC(a[b].getPositionC());
e<f&&(f=e,d=b)}return a[d]},setFlip:function(a,b){this.flip.x=a||0;this.flip.y=b||0},setUserData:function(a){for(var b in a)q(this[b])||(this[b]=a[b])},setShadow:function(a){this.shadowColor=a.shadowColor||!1;this.shadowBlur=q(a.shadowBlur)?a.shadowBlur:3;this.shadowX=a.shadowX||0;this.shadowY=a.shadowY||0},getDynamicBox:function(){var a=this.getPosition(1);return 0==this.angle?[e(this.x+this.box.x,this.y+this.box.y),e(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),e(this.x+this.box.x+this.w+
this.box.w,this.y+this.box.y+this.h+this.box.h),e(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h)]:[C(e(this.x+this.box.x,this.y+this.box.y),a,this.getAngle()),C(e(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),a,this.getAngle()),C(e(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),a,this.getAngle()),C(e(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h),a,this.getAngle())]},isDynamicIntersect:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),
d;for(d=0;d<b.length;d++)if(V(b[d],a))return!0;for(d=0;d<a.length;d++)if(V(a[d],b))return!0;return!1},isIntersect:function(a){return a.visible?this.angle||a.angle?this.isDynamicIntersect(a.getDynamicBox()):this.isStaticIntersect(a.getStaticBox()):!1},isDynamicInside:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),d,f=0;for(d=0;d<b.length;d++)V(b[d],a)&&f++;return f==b.length?!0:!1},drawDynamicBox:function(a){D(this,1);h.shadowColor="transparent";ia(e(this.x+this.box.x,this.y+this.box.y),
e(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);nb(e(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,a||"yellow");B()},drawStaticBox:function(a){h.shadowColor="transparent";ia(e(this.x+this.box.x,this.y+this.box.y),e(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);nb(e(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,a||"yellow")},isStaticIntersect:function(a){return this.y+this.box.y+this.h+this.box.h>=a.y&&this.x+this.box.x+this.w+this.box.w>=a.x&&
this.x+this.box.x<a.x+a.w&&this.y+this.box.y<a.y+a.h},getStaticBox:function(){return{x:this.x+this.box.x,y:this.y+this.box.y,w:this.w+this.box.w,h:this.h+this.box.h}},setAlpha:function(a){this.alpha!=a&&(this.alpha=0<=a?1>=a?a:1:0)},getAlpha:function(){return this.alpha},rotate:function(a){this.setAngle(Math.atan2(a.y-this.getPosition(1).y,a.x-this.getPosition(1).x)*(180/Math.PI))},setCenter:function(a){this.center=e(a.x,a.y)},nullCenter:function(a){a||(a=e(0,0));this.center=e(-this.w/2+a.x,-this.h/
2+a.y)},getCenter:function(){return e(this.center.x,this.center.y)},getBox:function(){return this.box},move:function(a){this.prevPosition=this.getPosition();this.x+=a.x||0;this.y+=a.y||0},circling:function(a,b,d){q(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.x=a.x+b*Math.cos(u(this.circlingAnglePointJS));this.y=a.y+b*Math.sin(u(this.circlingAnglePointJS));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+d},circlingC:function(a,b,d){q(this.circlingAnglePointJS)||
(this.circlingAnglePointJS=0);this.setPositionC(e(a.x+b*Math.cos(u(this.circlingAnglePointJS)),a.y+b*Math.sin(u(this.circlingAnglePointJS))));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+d},motion:function(a,b,d){q(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.x=a.x+b.w*Math.cos(u(this.motionPercentPointJS));this.y=a.y+b.h*Math.sin(u(this.motionPercentPointJS));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+
d},motionC:function(a,b,d){q(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.setPositionC(e(a.x+b.w*Math.cos(u(this.motionPercentPointJS)),a.y+b.h*Math.sin(u(this.motionPercentPointJS))));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+d},scale:function(a){this.w+=a.w||0;this.h+=a.h||0},scaleC:function(a){this.scale(a);this.move(e(-(a.w/2),-(a.h/2)))},getPosition:function(a){return 1==a?e(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y)):
2==a?(a=e(this.x+this.w/2,this.y+this.h/2),this.angle&&(a=C(a,this.getPosition(1),this.angle)),e(a.x,a.y)):e(this.x,this.y)},getPositionC:function(){return e(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y))},setPosition:function(a){this.x=q(a.x)?a.x:this.x;this.y=q(a.y)?a.y:this.y},setPositionS:function(a){this.x=a.x&&0!=a.x?a.x+g.x:this.x;this.y=a.y&&0!=a.y?a.y+g.y:this.y},setPositionC:function(a){var b=this.w/2+this.center.x,d=this.h/2+this.center.y;this.x=a.x&&0!=a.x?-b+a.x:this.x;
this.y=a.y&&0!=a.y?-d+a.y:this.y},setPositionCS:function(a){var b=this.w/2+this.center.x,d=this.h/2+this.center.y;this.x=a.x&&0!=a.x?-b+a.x+g.x:this.x;this.y=a.y&&0!=a.y?-d+a.y+g.y:this.y},getSize:function(){return I(this.w,this.h)},setSize:function(a){this.w=a.w?a.w:this.w;this.h=a.h?a.h:this.h},setSizeC:function(a){this.w=a.w?a.w:this.w;this.h=a.h?a.h:this.h;this.move(e(-(a.w/2),-(a.h/2)))},turn:function(a){this.angle%=360;this.angle+=a},rotateForAngle:function(a,b){var d=Math.abs(a);90>Math.abs(this.angle)||
180-d<=2*b&&this.setAngle(a);this.angle<a?this.turn(b):this.turn(-b)},moveAngle:function(a){this.prevPosition=this.getPosition();this.x+=a*Math.cos(u(this.angle));this.y+=a*Math.sin(u(this.angle))},moveTime:function(a,b){b=b||1;var d=this.getPosition();this.move(e((a.x-d.x)/b,(a.y-d.y)/b))},moveTimeC:function(a,b){b=b||1;var d=this.getPosition(1);this.move(e((a.x-d.x)/b,(a.y-d.y)/b))},getAngle:function(){return this.angle},setAngle:function(a){this.angle!=a&&(this.angle=a%360)},getDistance:function(a){return Math.sqrt(Math.pow(a.x-
this.getPosition(2).x,2)+Math.pow(a.y-this.getPosition(2).y,2))},getDistanceC:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(1).x,2)+Math.pow(a.y-this.getPosition(1).y,2))},setVisible:function(a){this.visible=1==a},isVisible:function(){return this.visible},isInCamera:function(){return this.angle?this.isInCameraDynamic():this.isInCameraStatic()},isInCameraStatic:function(){return this.x+this.w<g.x||this.x>g.x+n||this.y+this.h<g.y||this.y>g.y+p?!1:!0},isInCameraDynamic:function(){var a=
this.getDynamicBox(),b=[e(g.x,g.y),e(g.x+n,g.y),e(g.x+n,g.y+p),e(g.x,g.y+p)],d,f=0;for(d=0;d<a.length;d++)V(a[d],b)&&f++;return 0<f},onCollision:function(a){if(this.isIntersect(a)){this.prevPosition||(this.prevPosition=this.getPosition());var b=Math.abs(this.x-this.prevPosition.x),d=Math.abs(this.y-this.prevPosition.y),f=this.getPosition(2),g=a.getPosition(2);f.x<g.x?this.move(e(-b,!1)):this.move(e(b,!1))}this.isIntersect(a)&&(f.y<g.y?this.move(e(!1,-d)):this.move(e(!1,d)))},onArrCollision:function(a){var b;
for(b=0;b<a.length;b++)this.onCollision(a[b])},draw:function(){}};this.game.newBaseObject=function(a){return new x(a)};var Sa=function(a){x.call(this,a);this.type="RectObject"};Z(x,Sa);Sa.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)D(this),a=!0;ia(e(this.x,this.y),e(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);a&&B()}};this.game.newRectObject=function(a){return new Sa(a)};var aa=function(a){x.call(this,a);this.radius=a.radius||5;
this.w=2*this.radius;this.h=2*this.radius;this.type="CircleObject";a.positionC&&this.setPositionC(a.positionC)};Z(x,aa);aa.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)D(this),a=!0;ja(e(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth);a&&B()}};aa.prototype.scale=function(a){this.w+=a||0;this.h+=a||0;this.radius+=a/2||0;1==c&&this.move(e(-(a/2),-(a/2)))};aa.prototype.scaleC=function(a){this.w+=a||0;this.h+=a||0;this.radius+=
a/2||0;this.move(e(-(a/2),-(a/2)))};aa.prototype.getRadius=function(){return this.radius};aa.prototype.setRadius=function(a){a&&this.radius!=a&&(this.radius=a,this.w=2*a,this.h=2*a)};this.game.newCircleObject=function(a){return new aa(a)};var Ta=function(a){this.file=a.file;this.w=a.w;this.h=a.h;this.countX=a.countX;this.countY=a.countY;this.fullW=this.countX*this.w;this.fullH=this.countY*this.h;this.cnv=window.document.createElement("canvas");this.cnv.width=this.w;this.cnv.height=this.h;this.ctx=
this.cnv.getContext("2d");this.loaded=!1;this.x=a.x>>0;this.y=a.y>>0;a=window.document.createElement("img");var b=this;a.onload=function(){b.ctx.drawImage(this,0,0,b.w,b.h);b.loaded=!0;v.load()};a.src=this.file;v.add()};Ta.prototype.draw=function(){if(this.loaded){var a=-g.x+this.x,b=-g.y+this.y,d,f;for(f=0;f<this.countY;f++)if(!(f*this.h+this.h<g.y||f*this.h>g.y+p))for(d=0;d<this.countX;d++)d*this.w+this.w<g.x||d*this.w>g.x+n||h.drawImage(this.cnv,a+d*this.w,b+f*this.h,this.w,this.h)}};Ta.prototype.getSize=
function(){return this.loaded?I(this.fullW,this.fullH):I()};this.game.newBackgroundObject=function(a){return new Ta(a)};var Ua=function(a){x.call(this,a);this.type="EllipsObject"};Z(x,Ua);Ua.prototype.draw=function(){this.visible&&this.alpha&&(D(this),ja(e(this.x,this.y),this.h/2,this.fillColor,this.strokeColor,this.strokeWidth),B())};this.game.newEllipsObject=function(a){return new Ua(a)};var N=function(a){x.call(this,a);this.type="TextObject";this.text=a.text||"TextObject";this.color=a.color||"";
this.size=a.size||10;this.font=a.font||"sans-serif";this.style=a.style||"";this.align="left";this.padding=a.padding||2;this.w=Va(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||!1;this.strokeWidthText=a.strokeWidthText||!1;this.textDY=-this.size/7;a.positionC&&this.setPositionC(a.positionC)};Z(x,N);N.prototype.reStyle=function(a){this.text=a.text||this.text;this.color=a.color||this.color;this.size=a.size||this.size;this.font=
a.font||this.font;this.style=a.style||this.style;this.padding=a.padding||this.padding;this.w=Va(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||this.strokeColorText;this.strokeWidthText=a.strokeWidthText||this.strokeWidthText;this.strokeColor=a.strokeColor||this.strokeColor;this.strokeWidth=a.strokeWidth||this.strokeWidth;this.fillColor=a.fillColor||this.fillColor;this.textDY=-this.size/7};N.prototype.setText=function(a){this.text!=
a&&this.reStyle({text:a})};N.prototype.getText=function(){return this.text};N.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)D(this),a=!0;(this.fillColor||this.strokeColor)&&ia(e(this.x,this.y),e(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);ta(e(this.x+this.padding,this.textDY+this.y+this.padding),this.text,this.color,this.size,this.font,this.style,this.align,this.strokeColorText,this.strokeWidthText);a&&B()}};N.prototype.scale=function(a){this.reStyle({size:this.size+
a})};N.prototype.scaleC=function(a){this.reStyle({size:this.size+a});this.move(e(-a/2,-a/2))};N.prototype.setSize=function(a){this.size!=a&&this.reStyle({size:a})};N.prototype.setSizeC=function(a){this.size!=a&&(this.reStyle({size:a}),this.move(e(-a/2,-a/2)))};var Va=function(a,b,d,f){var e=window.document.createElement("canvas").getContext("2d");e.font=b+d+"px "+f;return e.measureText(a).width};this.OOP.getTextWidth=function(a){return Va(a.text,a.style||"",a.size||10,a.font||"sans-serif")};this.game.newTextObject=
function(a){return new N(a)};var E=function(a){x.call(this,a);this.type="PolygonObject";this.points=[];this.dX=this.dY=0;var b;if(a.points)for(b in a.points)this.addPoint(a.points[b]);this.pointColor=a.pointColor||!1};Z(x,E);E.prototype.addPoint=function(a){this.dY=this.dX=0;var b;if(this.y+a.y<this.y)for(b in this.dY=Math.abs(this.y+a.y-this.y),this.points)this.points[b].y+=this.dY;if(this.x+a.x<this.x)for(b in this.dX=Math.abs(this.x+a.x-this.x),this.points)this.points[b].x+=this.dX;this.points.push(e(a.x+
this.dX,a.y+this.dY));this.h=this.w=0;for(b in this.points)this.h+=this.y+this.points[b].y>this.y+this.h?this.points[b].y-this.h:0,this.w+=this.x+this.points[b].x>this.x+this.w?this.points[b].x-this.w:0};E.prototype.delPoint=function(a){var b,d=this.getPoints();this.clearPoints();for(b=0;b<d.length;b++)b!=a&&this.addPoint(d[b])};E.prototype.clearPoints=function(){this.points=[];this.count=0};E.prototype.getPoints=function(){return this.points};E.prototype.getCount=function(){return this.points.length};
E.prototype.getPoint=function(a){return this.points[a]};E.prototype.scale=function(a){};E.prototype.drawDynamicBox=function(a){var b=!1;if(this.angle||1!=this.alpha)D(this),b=!0;ob(this.x,this.y,this.points,this.fillColor,a||"yellow",2,"red");b&&B()};E.prototype.getDynamicBox=function(){var a=[],b;if(this.angle){var d=this.getPosition(1);for(b in this.points)a.push(C(da(this.points[b],e(this.x,this.y)),d,this.getAngle()))}else for(b in this.points)a.push(da(this.points[b],e(this.x,this.y)));return a};
E.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)D(this),a=!0;ob(this.x,this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,this.pointColor);a&&B()}};this.game.newPolygonObject=function(a){return new E(a)};var ka=function(a){x.call(this,a);this.type="ImageObject";this.w=a.w?a.w:0;this.h=a.h?a.h:0;this.loaded=!1;this.file="";pb(a.file,this,a.scale||1)};Z(x,ka);ka.prototype.draw=function(){if(this.visible&&this.alpha&&this.loaded){var a=
!1;if(this.angle||1!=this.alpha||this.shadowColor)D(this),a=!0;qb(e(this.x,this.y),I(this.w,this.h),this.file);a&&B()}};ka.prototype.simpleDraw=function(a){if(this.loaded){var b=!1;if(this.angle||1!=this.alpha)D(this),b=!0;qb(e(a.x,a.y),I(this.w,this.h),this.file);b&&B()}};ka.prototype.setImage=function(a,b){this.file!=a&&(q(m[a])?this.file=a:(this.loaded=!1,this.origHeight=this.origWidth=0,pb(a,this)))};ka.prototype.getImage=function(){return this.file};this.game.newImageObject=function(a){return new ka(a)};
var H=function(a){x.call(this,a);this.type="AnimationObject";this.frame=0;this.anim=a.animation;this.step=a.delay||10;this.toFrameStep=this.difStep=0};Z(x,H);H.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y)D(this),a=!0;Wa(this.anim,e(this.x,this.y),I(this.w,this.h),this.frame);this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+1:0,this.difStep=0):this.difStep++;a&&B()}};H.prototype.drawFrames=function(a,b,d){if(this.visible&&
this.alpha){d=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y)D(this),d=!0;Wa(this.anim,e(this.x,this.y),I(this.w,this.h),this.frame);this.difStep>this.step?(this.frame=this.frame<b?this.frame+1:a,this.difStep=0):this.difStep++;d&&B()}};H.prototype.drawFrame=function(a){if(this.visible&&this.alpha){var b=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y)D(this),b=!0;Wa(this.anim,e(this.x,this.y),I(this.w,this.h),a);b&&B()}};H.prototype.drawToFrame=function(a){if(this.visible&&this.alpha){if(this.frame<
a)this.toFrameStep=1;else if(this.frame>a)this.toFrameStep=-1;else{this.drawFrame(a);return}this.drawFrame(this.frame);this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+this.toFrameStep:0,this.difStep=0):this.difStep++}};H.prototype.drawReverFrames=function(a,b){this.visible&&this.alpha&&(this.drawFrame(this.frame),this.difStep>this.step?(this.frame<=a?this.toFrameStep=1:this.frame>=b&&(this.toFrameStep=-1),this.frame=this.frame<=this.anim.r?this.frame+this.toFrameStep:0,this.difStep=
0):this.difStep++)};H.prototype.setAnimation=function(a){this.anim=a};H.prototype.getAnimation=function(){return this.anim};H.prototype.setDelay=function(a){this.step=0<a?a:this.step};H.prototype.getDelay=function(){return this.step};this.game.newAnimationObject=function(a){return new H(a)};var la=function(a){this.file=a;this.loaded=!1;this.h=this.w=0;this.toLoad=[];var b=window.document.createElement("img"),d=this;b.onload=function(){d.loaded=!0;d.w=this.width;d.h=this.height;d.img=window.document.createElement("canvas");
d.img.width=this.width;d.img.height=this.height;d.context=d.img.getContext("2d");d.context.drawImage(this,0,0);d.toLoad.length&&gb(d.toLoad,function(a){a.func(d.context,a.w,a.h,a.r)});v.load()};b.src=a;v.add()};la.prototype.onContext=function(a){this.loaded?a(this.context,this.w,this.h,1):this.toLoad.push({w:this.w,h:this.h,r:1,func:a})};la.prototype.getAnimation=function(a,b,d,f,e){var g=function(a,b,d,f,e,g){this.image=a;this.x=b;this.y=d;this.w=f;this.h=e;this.r=g?g-1:0};g.prototype={onContext:function(a){this.image.loaded?
a(this.image.context,this.w,this.h,this.r):this.image.toLoad.push({w:this.w,h:this.h,r:this.r,func:a})},getImage:function(){return this.image},getCount:function(){return this.r}};return new g(this,a,b,d,f,e)};var Xa=function(a,b){this.loaded=!0;this.w=a;this.h=b;this.img=window.document.createElement("canvas");this.img.width=a;this.img.height=b;this.context=this.img.getContext("2d")};Xa.prototype.onContext=la.prototype.onContext;Xa.prototype.getAnimation=la.prototype.getAnimation;this.tiles.newDrawImage=
function(a,b){return new Xa(a,b)};this.tiles.newImage=function(a){return new la(a)};this.tiles.newAnimation=function(a,b,d,f){return(new la(a)).getAnimation(0,0,b,d,f)};var Wa=function(a,b,d,f){a.image.loaded&&h.drawImage(a.image.img,a.x+a.w*f,a.y,a.w,a.h,b.x+-g.x,b.y+-g.y,d.w,d.h)},m={},pb=function(a,b,d){if(q(m[a]))b.loaded=!0,b.file=a;else{var f=window.document.createElement("img");f.onload=function(){m[a]={};m[a].img=this;m[a].w=this.width;m[a].h=this.height;q(b)&&(b.loaded=!0,b.w||(b.w=this.width*
(d?d:1)),b.h||(b.h=this.height*(d?d:1)),b.file=a);v.load()};f.src=a;v.add()}},qb=function(a,b,d){d&&h.drawImage(m[d].img,0,0,m[d].w,m[d].h,a.x+-g.x,a.y+-g.y,b.w,b.h)},rb=function(a){this.type="Mesh";this.objs=[];this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.count=0;if(a.add)for(var b in a.add)this.add(a.add[b]);this.angle&&this.setAngle(this.angle)};rb.prototype={getCount:function(){return this.count},add:function(a){this.count++;this.objs.push(a);a.offsetMesh=a.getPosition(1);a.turn(this.angle);
a.setPositionC(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},del:function(a){for(var b in this.objs)this.objs[b]==a&&(this.objs.splice(b,1),this.count--)},draw:function(a){for(var b in this.objs)this.objs[b].draw()},move:function(a){this.x+=a.x||0;this.y+=a.y||0;for(var b in this.objs)a=this.objs[b],a.setPositionC(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},turn:function(a){if(0!=a){this.angle%=360;this.angle+=a;var b,d,f=e(this.x,this.y);for(b in this.objs)d=this.objs[b],d.turn(a),d.setPositionC(C(e(this.x+
d.offsetMesh.x,this.y+d.offsetMesh.y),f,this.angle))}},setAngle:function(a){if(a!=this.angle){this.angle=a%=360;var b,d,f=e(this.x,this.y);for(b in this.objs)d=this.objs[b],d.setAngle(a),d.setPositionC(C(e(this.x+d.offsetMesh.x,this.y+d.offsetMesh.y),f,this.angle))}},setPosition:function(a){if(this.x!=a.x||this.y!=a.y){this.x=a.x||this.x;this.y=a.y||this.y;for(var b in this.objs)a=this.objs[b],this.angle?a.setPositionC(C(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y),e(this.x,this.y),this.angle)):
a.setPositionC(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))}},isDynamicIntersect:function(a){if(3>a.length)return!1;var b,d;for(b in this.objs)if(d=this.objs[b],d.isDynamicIntersect(a))return d;return!1},isStaticIntersect:function(a){var b,d;for(b in this.objs)if(d=this.objs[b],d.isStaticIntersect(a))return d;return!1}};this.game.newMesh=function(a){return new rb(a)};this.camera.circling=function(a,b,d){q(this.circlingAnglePointJS)||(this.circlingAnglePointJS=d);g.x=a.x+b*Math.cos(u(this.circlingAnglePointJS));
g.y=a.y+b*Math.sin(u(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?d:this.circlingAnglePointJS+d};this.camera.circlingC=function(a,b,d){q(this.circlingAnglePointJS)||(this.circlingAnglePointJS=d);g.x=-z+a.x+b*Math.cos(u(this.circlingAnglePointJS));g.y=-A+a.y+b*Math.sin(u(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?d:this.circlingAnglePointJS+d};this.camera.motion=function(a,b,d){q(this.motionPercentPointJS)||(this.motionPercentPointJS=
b);g.x=a.x+b.w*Math.cos(u(this.motionPercentPointJS));g.y=a.y+b.h*Math.sin(u(this.motionPercentPointJS));this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+d};this.camera.motionC=function(a,b,d){q(this.motionPercentPointJS)||(this.motionPercentPointJS=b);this.setPositionC(e(a.x+b.w*Math.cos(u(this.motionPercentPointJS)),a.y+b.h*Math.sin(u(this.motionPercentPointJS))));this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+d};this.camera.move=
function(a){g.x+=a.x||0;g.y+=a.y||0};this.camera.moveTime=function(a,b){b=b||1;var d=e(g.x,g.y);this.move(e((a.x-d.x)/b,(a.y-d.y)/b))};this.camera.moveTimeC=function(a,b){b=b||1;var d=e(g.x+z,g.y+A);this.move(e((a.x-d.x)/b,(a.y-d.y)/b))};this.camera.setPosition=function(a){Ra(e(a.x?a.x:0,a.y?a.y:0))};this.camera.setPositionC=function(a){Ra(e(a.x?a.x-z:0,a.y?a.y-A:0))};this.camera.getPosition=function(a){return a?e(g.x+z,g.y+A):e(g.x,g.y)};this.camera.getPositionC=function(){return e(g.x+z,g.y+A)};
this.camera.getStaticBox=function(){return{x:g.x,y:g.y,w:g.x+n,h:g.y+p}};this.camera.getDynamicBox=function(){return[e(g.x,g.y),e(g.x+n,g.y),e(g.x+n,g.y+p),e(g.x,g.y+p)]};var Ra=function(a){g=e(a.x,a.y)},B=function(a){h.restore();h.globalAlpha=t.globalAlpha},D=function(a,b){h.save();var d=a.getPosition(1);a.angle&&(h.translate(-g.x+d.x,-g.y+d.y),h.rotate(u(a.angle)),h.translate(-d.x+g.x,-d.y+g.y));1!=a.alpha&&(h.globalAlpha=a.alpha);if(a.flip.x||a.flip.y)h.translate(-g.x+d.x,-g.y+d.y),h.scale(a.flip.x?
-1:1,a.flip.y?-1:1),h.translate(-d.x+g.x,-d.y+g.y);a.shadowColor&&(h.shadowBlur=a.shadowBlur,h.shadowColor=a.shadowColor,h.shadowOffsetX=a.shadowX,h.shadowOffsetY=a.shadowY);if("EllipsObject"==a.type&&!b){var d=a.w/2,f=a.h/2,X=e(-g.x+a.x,-g.y+a.y);h.translate(X.x,X.y);h.scale(d/f,1);h.translate(-X.x,-X.y)}};this.system.setContextSettings=function(a){h.save();for(var b in a)h[b]=a[b]};this.system.defaultSettings=function(){B()};var kb=function(a,b){h.clearRect(a.x,a.y,b.x,b.y)};this.game.clear=function(){kb(e(0,
0),e(n,p))};this.game.fill=function(a){h.fillStyle=a||"white";h.fillRect(0,0,n,p)};var ob=function(a,b,d,f,X,k,l){if(!(3>d.length)){var m;if(f&&!(3>d.length)){h.fillStyle=f;f=-g.x+a;m=-g.y+b;var n;h.beginPath();h.moveTo(f+d[0].x,m+d[0].y);for(n=1;n<d.length;n++)h.lineTo(f+d[n].x,m+d[n].y);h.closePath();h.fill()}for(f=0;f<d.length;f++)m=f+1<d.length?f+1:0,X&&O(da(d[f],e(a,b)),da(d[m],e(a,b)),X,k),l&&Ha(da(d[f],e(a,b)),l)}};this.brush.drawPolygon=function(a){var b=a.points||[],d=a.fillColor||!1,f=a.strokeColor||
!1,e=a.strokeWidth||1;a=a.pointColor||!1;if(!(3>b.length)){var k;if(d&&!(3>b.length)){h.fillStyle=d;d=-g.x;k=-g.y;var l;h.beginPath();h.moveTo(d+b[0].x,k+b[0].y);for(l=1;l<b.length;l++)h.lineTo(d+b[l].x,k+b[l].y);h.closePath();h.fill()}for(d=0;d<b.length;d++)k=d+1<b.length?d+1:0,f&&O(b[d],b[k],f,e),a&&Ha(b[d],a)}};var ta=function(a,b,d,f,e,k,l,m,n){h.textAlign=l;h.lineWidth=n;h.font=(k?k+" ":"")+f+"px "+e;f=-g.x;e=-g.y;d&&(h.fillStyle=d,h.fillText(b,f+a.x,e+a.y));m&&(h.strokeStyle=m,h.strokeText(b,
f+a.x,e+a.y))};this.brush.drawText=function(a){ta(e(a.x||0,a.y||0),a.text,a.color||!1,a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColorText||!1,a.strokeWidthText||2)};this.brush.drawTextS=function(a){ta(e((a.x||0)+g.x,(a.y||0)+g.y),a.text,a.color||t.fillStyle,a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)};this.brush.drawTextLines=function(a){if(a.lines){var b;for(b=0;b<a.lines.length;b++)ta(e(a.x,a.y+a.size*b),a.lines[b],a.color||t.fillStyle,
a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)}};this.brush.drawTextLinesS=function(a){if(a.lines){var b;for(b=0;b<a.lines.length;b++)ta(e(a.x+g.x,a.y+g.y+a.size*b),a.lines[b],a.color||t.fillStyle,a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)}};var nb=function(a,b,d){O(e(a.x-b,a.y),e(a.x+b,a.y),d,2);O(e(a.x,a.y-b),e(a.x,a.y+b),d,2)},ia=function(a,b,d,f,e){h.fillStyle=d;h.strokeStyle=f;h.lineWidth=e;f=-g.x+(e?e/
2:0);var k=-g.y+(e?e/2:0);d&&h.fillRect(a.x+f,a.y+k,b.x,b.y);e&&h.strokeRect(a.x+f,a.y+k,b.x,b.y)};this.brush.drawRect=function(a){ia(e(a.x,a.y),e(a.w,a.h),a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};this.brush.drawRectS=function(a){ia(e(a.x+g.x,a.y+g.y),e(a.w,a.h),a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};var Ha=function(a,b){(h.fillStyle=b)&&h.fillRect(-g.x+a.x-1,-g.y+a.y-1,2,2)};this.brush.drawPoint=function(a){Ha(e(a.x,a.y),a.fillColor||!1)};this.brush.drawPointS=
function(a){Ha(e(a.x+g.x,a.y+g.y),a.fillColor||!1)};var ja=function(a,b,d,f,e){h.fillStyle=d;h.strokeStyle=f;h.lineWidth=e;f=-g.x+b+(e?e/2:0);var k=-g.y+b+(e?e/2:0);h.beginPath();h.arc(a.x+f,a.y+k,b,0,2*Math.PI,!0);h.closePath();d&&h.fill();e&&h.stroke()};this.brush.drawCircle=function(a){ja(e(a.x,a.y),a.radius,a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};this.brush.drawCircleS=function(a){ja(e(a.x+g.x,a.y+g.y),a.radius,a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||
!1)};var O=function(a,b,d,f){h.strokeStyle=d;h.lineWidth=f;d=-g.x;f=-g.y;h.beginPath();h.moveTo(d+a.x,f+a.y);h.lineTo(d+b.x,f+b.y);h.closePath();h.stroke()};this.brush.drawLineAngle=function(a){var b=C(e(a.x+a.length,a.y),e(a.x,a.y),a.angle);O(e(a.x,a.y),e(b.x,b.y),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineAngleS=function(a){var b=C(e(g.x+a.x+a.length,g.y+a.y),e(g.x+a.x,g.y+a.y),a.angle);O(e(g.x+a.x,g.y+a.y),e(b.x,b.y),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLine=
function(a){O(e(a.x1,a.y1),e(a.x1+a.x2,a.y1+a.y2),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineS=function(a){O(e(g.x+a.x1,g.y+a.y1),e(g.x+a.x2,g.y+a.y2),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineA=function(a){O(e(a.x1,a.y1),e(a.x2,a.y2),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineAS=function(a){O(e(a.x1+g.x,a.y1+g.y),e(a.x2+g.x,a.y2+g.y),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawEllips=function(a){var b=a.w/
2,d=a.h/2,f=e(-g.x+a.x,-g.y+a.y);h.save();h.translate(f.x,f.y);h.scale(b/d,1);h.translate(-f.x,-f.y);ja(e(a.x,a.y),d,a.fillColor,a.strokeColor,a.strokeWidth);h.restore()};this.brush.drawEllipsS=function(a){var b=a.w/2,d=a.h/2,f=e(a.x,a.y);h.save();h.translate(f.x,f.y);h.scale(b/d,1);h.translate(-f.x,-f.y);ja(e(g.x+a.x,g.y+a.y),d,a.fillColor,a.strokeColor,a.strokeWidth);h.restore()};this.brush.drawImageS=function(a){if(a.file)if(q(m[a.file])){if(m[a.file].loaded){var b=a.x||0,d=a.y||0,f=a.w||m[a.file].w,
e=a.h||m[a.file].h;a.scale&&(f*=a.scale,e*=a.scale);h.drawImage(m[a.file].img,0,0,m[a.file].w,m[a.file].h,b,d,f,e)}}else m[a.file]={},m[a.file].loaded=!1,b=window.document.createElement("img"),b.onload=function(){m[a.file].loaded=!0;m[a.file].img=this;m[a.file].w=this.width;m[a.file].h=this.height;v.load()},b.src=a.file,v.add()};this.brush.drawImage=function(a){if(a.file)if(q(m[a.file])){if(m[a.file].loaded){var b=a.x||0,d=a.y||0,f=a.w||m[a.file].w,e=a.h||m[a.file].h;a.scale&&(f*=a.scale,e*=a.scale);
h.drawImage(m[a.file].img,0,0,m[a.file].w,m[a.file].h,-g.x+b,-g.y+d,f,e)}}else m[a.file]={},m[a.file].loaded=!1,b=window.document.createElement("img"),b.onload=function(){m[a.file].loaded=!0;m[a.file].img=this;m[a.file].w=this.width;m[a.file].h=this.height;v.load()},b.src=a.file,v.add()};this.brush.getPixelColor=function(a,b){var d=h.getImageData(a,b,1,1).data;return"rgb("+d[0]+", "+d[1]+", "+d[2]+")"};this.brush.setPixelColor=function(a,b,d){var f=h.createImageData(1,1);f.data[0]=d.r||f.data[0];
f.data[1]=d.g||f.data[1];f.data[2]=d.b||f.data[2];f.data[3]=d.a||255;h.putImageData(f,a,b)};this.brush.onPixel=function(a,b,d){var f=h.getImageData(a,b,1,1),e={r:f.data[0],g:f.data[1],b:f.data[2],a:f.data[3]?f.data[3]:255};d(e);f.data[0]=e.r;f.data[1]=e.g;f.data[2]=e.b;f.data[3]=e.a;h.putImageData(f,a,b)};this.brush.onPixels=function(a,b,d,f,e){d=h.getImageData(a,b,d,f);var g;f=0;for(g=d.data.length;f<g;f+=4){var k={r:d.data[f],g:d.data[f+1],b:d.data[f+2],a:d.data[f+3]?d.data[f+3]:255};e(k);d.data[f]=
k.r;d.data[f+1]=k.g;d.data[f+2]=k.b;d.data[f+3]=k.a}h.putImageData(d,a,b)};this.brush.onRawPixels=function(a,b,d,f,e){d=h.getImageData(a,b,d,f);e(d.data,d.data.length);h.putImageData(d,a,b)};var F=window.AudioContext||window.webkitAudioContext||!1;(F=F?new F:!1)&&F.listener.setPosition(0,0,0);var G=function(a,b){F||U('module "wAudio" is not supported! use a "audio"');this.vol=b&&1>=b&&0<b?b:1;this.loadPLay=this.nextPlay=this.loaded=this.playing=!1;this.pausedTime=this.duration=this.startTime=0;var d=
this,f=new XMLHttpRequest;f.open("GET",a,!0);f.responseType="arraybuffer";f.onload=function(a){F.decodeAudioData(this.response,function(a){d.wABuffer=a;d.duration=d.wABuffer.duration;d.wAGain=F.createGain();d.wAGain.gain.value=d.vol;d.wAPanner=F.createPanner();d.wAPanner.setPosition(0,0,1);d.wAPanner.panningModel="equalpower";v.load();d.loaded=!0;d.loadPlay&&d.replay()},function(a){U("error in wAudio.newAudio: error decoding file",a)})};a?f.send():U("error in wAudio.newAudio: Where is file?");v.add()};
G.prototype.play=function(a){if(!this.loaded)this.loadPlay=!0;else if(!this.playing){this.playing=!0;this.wASource=F.createBufferSource();this.wASource.buffer=this.wABuffer;this.wAListener=F.destination;this.wASource.connect(this.wAGain);this.wAGain.connect(this.wAPanner);this.wAPanner.connect(this.wAListener);this.wASource.start(0,this.pausedTime,this.duration);this.startTime=F.currentTime;var b=this;this.wASource.onended=function(){b.playing=!1;b.startTime=0;b.pausedTime=0;b.nextPlay&&b.nextPlay.replay()}}};
G.prototype.replay=function(a){this.loaded?(this.stop(),this.play()):this.loadPlay=!0};G.prototype.stop=function(){this.pause();this.pausedTime=this.startTime=0};G.prototype.pause=function(){if(this.playing){this.pausedTime=this.getProgress();this.playing=!1;this.wASource.stop(0);var a=this;this.wASource.onended=function(){a.playing=!1}}};G.prototype.getProgress=function(){return this.playing?F.currentTime-this.startTime+this.pausedTime:this.pausedTime};G.prototype.playPause=function(){this.playing?
this.pause():this.play()};G.prototype.setNextPlay=function(a){this.nextPlay=a};G.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.wAGain.gain.value=this.vol};G.prototype.getVolume=function(){return this.vol};G.prototype.setSide=function(a){this.side=a;this.wAPanner&&this.wAPanner.setPosition(this.side,0,1-Math.abs(this.side))};G.prototype.getSide=function(){return this.side};this.wAudio.newAudio=function(a,b){return new G(a,b)};var T=function(a,b){var d,f,e=window.document.createElement("audio");
if("string"==typeof a){var g=window.document.createElement("source");g.src=a;e.appendChild(g)}else for(d=0,f=a.length;d<f;d++)g=window.document.createElement("source"),g.src=a[d],e.appendChild(g);this.vol=b&&1>=b&&0<b?b:1;this.playing=0;this.audio=e;this.nextPlay=this.loaded=!1;this.audio.volume=this.vol;var h=this;this.audio.onloadeddata=function(){h.loaded=!0;v.load()};this.audio.onended=function(){h.playing=!1;h.nextPlay&&h.nextPlay.play()};this.audio.load();v.add()};T.prototype.play=function(a){this.playing||
(a&&(this.vol=a&&1>=a&&0<a?a:this.vol,this.audio.volume=this.vol),this.playing=!0,this.audio.play())};T.prototype.replay=function(a){a&&this.setVolume(a);this.playing=!0;this.audio.currentTime=0;this.audio.play()};T.prototype.stop=function(){this.playing&&(this.playing=!1,this.audio.pause(),this.audio.currentTime=0)};T.prototype.pause=function(){this.playing&&(this.playing=!1,this.audio.pause())};T.prototype.playPause=function(){this.playing?this.pause():this.play()};T.prototype.setNextPlay=function(a){this.nextPlay=
a};T.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.audio.volume=this.vol};T.prototype.getVolume=function(){return this.vol};this.audio.newAudio=function(a,b){return new T(a,b)};this.dialogs={openLine:function(a,b){P.game.stop();var d=window.document.createElement("input");d.type="text";d.style.position="fixed";d.style.border="none";d.style.zIndex=l.style.zIndex+1;d.style.outline="none";d.style.backgroundColor=a.fillColor||"white";d.style.color=a.color||"black";d.style.top=
(a.y?a.y>>0:0)+"px";d.style.left=(a.x?a.x>>0:0)+"px";d.style.width=(a.w?a.w>>0:0)+"px";d.style.fontSize=(a.size?a.size>>0:10)+"px";d.onkeydown=function(a){a.stopPropagation();if(27==a.keyCode||13==a.keyCode)a=d.value.trim(),"function"==typeof b&&b(""!=a?a:!1),window.document.body.removeChild(d),P.game.resume()};k.attach(d);d.focus()},openArea:function(a,b){P.game.stop();var d=window.document.createElement("textarea");d.style.position="fixed";d.style.border="none";d.style.zIndex=l.style.zIndex+1;d.style.overflowY=
"scroll";d.style.outline="none";d.style.backgroundColor=a.fillColor||"white";d.style.color=a.color||"black";d.style.top=(a.y?a.y>>0:0)+"px";d.style.left=(a.x?a.x>>0:0)+"px";d.style.width=(a.w?a.w>>0:0)+"px";d.style.height=(a.h?a.h>>0:0)+"px";d.style.fontSize=(a.size?a.size>>0:10)+"px";d.style.maxWidth=(a.w?a.w>>0:0)+"px";d.style.maxHeight=(a.h?a.h>>0:0)+"px";d.onkeydown=function(a){a.stopPropagation();27==a.keyCode&&(a=d.value.trim(),"function"==typeof b&&b(""!=a?a:!1),window.document.body.removeChild(d),
P.game.resume())};k.attach(d);d.focus()},openTouchLine:function(a,b,d){P.game.stop();P.touchControl.exitTouchControl();var e=window.document.createElement("input");e.type="text";e.style.position="fixed";e.style.border="none";e.style.zIndex=l.style.zIndex+1;e.style.outline="none";e.style.backgroundColor=a.fillColor||"white";e.style.color=a.color||"black";e.style.top=(a.y?a.y>>0:0)+"px";e.style.left=(a.x?a.x>>0:0)+"px";e.style.width=(a.w?a.w>>0:0)+"px";e.style.fontSize=(a.size?a.size>>0:10)+"px";var g=
window.document.createElement("div");g.style.padding=(b.padding||10)+"px";g.align="center";g.style.position="fixed";g.style.border="none";g.style.zIndex=l.style.zIndex+1;g.style.backgroundColor=b.fillColor||"white";g.style.color=b.color||"black";g.innerHTML=b.text||"OK";g.style.top=(b.y?b.y>>0:0)+"px";g.style.left=(b.x?b.x>>0:0)+"px";b.w&&(g.style.width=(b.w>>0)+"px");b.h&&(g.style.height=(b.h>>0)+"px");g.style.fontSize=(b.size?b.size>>0:10)+"px";g.addEventListener("touchstart",function(a){a.preventDefault();
a.stopPropagation();P.touchControl.initTouchControl();a=e.value.trim();"function"==typeof d&&d(""!=a?a:!1);window.document.body.removeChild(e);window.document.body.removeChild(g);P.game.resume()},!0);k.attach(e);k.attach(g);e.focus()}};var v={count:0,loaded:0,errored:0,add:function(){this.count+=1},load:function(){this.loaded+=1},error:function(){this.errored+=1}};this.resources.isLoaded=function(){return v.count==v.loaded};this.resources.getProgress=function(){return Math.ceil(v.loaded/v.count*100)};
var sb=0,tb=0,Ya=0;this.system.initFPSCheck=function(){k.addEvent("postLoop","fpsCheckUpdate",function(){Ya+=1;1E3<=M-tb&&(sb=Ya,Ya=0,tb=M)})};this.system.getFPS=function(){return sb};this.OOP.newRever=function(a,b,d){var e=function(a,b,d){this.min=a;this.max=b;this.step=d;this.value=a;this.to=d};e.prototype={update:function(){var a=this.value;this.value<=this.min?this.to=this.step:this.value>=this.max&&(this.to=-this.step);this.value+=this.to;return a},getValue:function(){return this.value},setValue:function(a){this.value=
parseFloat(a)},setStep:function(a){this.step=a},getStep:function(){return this.step}};return new e(a,b,d)};var ub={};this.OOP.once=function(a,b){ub[a]||(ub[a]=!0,b())};this.OOP.newTimer=function(a,b){if(0>=a)return ha("error in system.newTimer: variable < 0, Timer is not created");var d={time:0<a?a:1E3,func:b,startTime:!1,ending:!1,start:function(){this.ending||this.startTime||(this.startTime=M)},run:function(){!this.ending&&this.startTime&&M-this.startTime>=this.time&&(this.func(),this.ending=!0)},
end:function(){this.ending||(this.ending=!0,this.func())},restart:function(a){this.startTime||this.start();if(this.ending){if(a&&0>=a)return ha("error in Timer.restart: variable < 0");a&&(this.time=a);this.ending=!1;this.startTime=M}},stop:function(){this.ending||(this.ending=!0)}};k.addEvent("postLoop","timer"+Q(-100,100)*Q(-100,100)+M,function(){d.run()});return d};window.onload=function(){for(var a in t)h[a]=t[a];for(a in k.events.onload)if("function"==typeof k.events.onload[a])k.events.onload[a]();
k.loaded=!0;return!1};window.onblur=function(){if(W)return k.runEvent("gameBlur"),!1};window.onfocus=function(){if(!W)return k.runEvent("gameFocus"),!1};window.onresize=function(){h.textBaseline=t.textBaseline;k.runEvent("gameResize");return!1};window.onclick=function(){window.focus()}};
